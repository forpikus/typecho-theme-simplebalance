function insertAtCursor(e,t){if(e.focus(),document.selection)sel=document.selection.createRange(),sel.text=t;else{var n=e.selectionStart,r=e.scrollTop,s=e.selectionEnd;e.value=e.value.substring(0,n)+t+e.value.substring(s,e.value.length),n+=t.length,e.setSelectionRange(n,n),e.scrollTop=r}}function getCaretPos(e){var t=0;if(document.selection){var n=document.selection.createRange(),r=n.duplicate();r.moveToElementText(e),r.setEndPoint("EndToEnd",n),e.selectionStart=r.text.length-n.text.length,e.selectionEnd=e.selectionStart+n.text.length,t=e.selectionStart}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function getCurrentLineBlanks(e){for(var t=getCaretPos(e),n=e.value,r=t-1;r>=0&&"\n"!=n.charAt(r);)r--;r++;for(var s="";r<n.length;){var o=n.charAt(r);if(" "!=o&&"	"!=o)break;s+=o,r++}return s}function set_tab_indent_for_textareas(){$("textarea").each(function(){$(this).keydown(function(e){e.target==this&&(13==e.keyCode?last_blanks=getCurrentLineBlanks(this):9==e.keyCode&&(e.preventDefault(),insertAtCursor(this,'	'),this.returnValue=!1))}).keyup(function(e){e.target==this&&13==e.keyCode&&insertAtCursor(this,last_blanks)})})}